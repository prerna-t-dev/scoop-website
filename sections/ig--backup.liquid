{%- render 'section-spacing-collapsing' -%}

{%- comment -%}
------------------------------------------------------------------------------------------------------------------------
CSS
------------------------------------------------------------------------------------------------------------------------
{%- endcomment -%}
<style>
  #shopify-section-{{ section.id }} .ig-carousel {
    --content-over-media-gap: var(--grid-gutter);
  }

  #shopify-section-{{ section.id }} .ig-carousel__header {
    display: flex;
    align-items: baseline;
    gap: 20px;
    margin-bottom: {{ section.settings.header_spacing_mobile }}px;
    flex-wrap: wrap;
  }

  #shopify-section-{{ section.id }} .ig-carousel__title {
    font-size: {{ section.settings.title_size_mobile }}px;
    font-weight: {{ section.settings.title_weight }};
    color: {{ section.settings.title_color }};
    font-family: var(--heading-font-family);
    font-style: italic;
    margin: 0;
  }

  #shopify-section-{{ section.id }} .ig-carousel__handle {
    font-size: {{ section.settings.handle_size_mobile }}px;
    color: {{ section.settings.handle_color }};
    font-family: var(--text-font-family);
    text-decoration: none;
    font-weight: 500;
    margin: 0;
    text-decoration: underline;
  }

  #shopify-section-{{ section.id }} .ig-carousel__handle:hover {
    text-decoration: underline;
  }

  #shopify-section-{{ section.id }} .ig-carousel__grid {
    --ig-carousel-card-width: 60vw;
    --ig-carousel-grid: auto / auto-flow var(--ig-carousel-card-width);
  }

  /* Mobile Grid */
  #shopify-section-{{ section.id }} .ig-carousel__grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: {{ section.settings.gap_mobile }}px;
  }

  #shopify-section-{{ section.id }} .ig-carousel__card {
    aspect-ratio: 1 / 1 !important;
    border-radius: {{ section.settings.card_border_radius }}px;
    overflow: hidden;
    position: relative;
  }

  {%- for block in section.blocks -%}
    #shopify-section-{{ section.id }} .ig-carousel__card[data-block-id="{{ block.id }}"] {
      background: {{ block.settings.background_color }};
    }
  {%- endfor -%}

  #shopify-section-{{ section.id }} .ig-carousel__card {
    display: block;
  }

  #shopify-section-{{ section.id }} .ig-carousel__card a {
    display: block;
    width: 100%;
    height: 100%;
    aspect-ratio: 1 / 1 !important;
  }

  #shopify-section-{{ section.id }} .ig-carousel__card img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    aspect-ratio: 1 / 1 !important;
  }

  /* Scallop button styling - inherits from circle-button positioning and hover behavior */
  #shopify-section-{{ section.id }} .circle-button.ig-carousel-scallop-button {
    background: transparent !important;
    border: none !important;
    padding: 0 !important;
    cursor: pointer;
    display: none;
    align-items: center;
    justify-content: center;
    box-shadow: none !important;
    width: 51px !important;
    height: 51px !important;
    min-width: 51px !important;
    min-height: 51px !important;
  }

  #shopify-section-{{ section.id }} .circle-button.ig-carousel-scallop-button svg {
    width: 51px !important;
    height: 51px !important;
    display: block;
    filter: none !important;
  }

  @media screen and (min-width: 700px) {
    #shopify-section-{{ section.id }} .ig-carousel__header {
      margin-bottom: {{ section.settings.header_spacing_desktop }}px;
    }

    #shopify-section-{{ section.id }} .ig-carousel__title {
      font-size: {{ section.settings.title_size_desktop }}px;
    }

    #shopify-section-{{ section.id }} .ig-carousel__handle {
      font-size: {{ section.settings.handle_size_desktop }}px;
    }

    #shopify-section-{{ section.id }} .ig-carousel__grid {
      --ig-carousel-card-width: calc((100vw - var(--container-gutter) * 2) / 3.5);
      --ig-carousel-grid: auto / auto-flow var(--ig-carousel-card-width);
    }

    /* Desktop Carousel */
    #shopify-section-{{ section.id }} .ig-carousel__grid {
      display: grid;
      grid: var(--ig-carousel-grid);
      gap: {{ section.settings.gap_desktop }}px;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    #shopify-section-{{ section.id }} .ig-carousel__grid::-webkit-scrollbar {
      display: none;
    }

    #shopify-section-{{ section.id }} .ig-carousel__card {
      scroll-snap-align: start;
    }

    /* Show carousel buttons on desktop */
    #shopify-section-{{ section.id }} .circle-button.ig-carousel-scallop-button {
      display: inline-flex;
    }
  }

  @media screen and (min-width: 1000px) {
    #shopify-section-{{ section.id }} .ig-carousel__grid {
      --ig-carousel-card-width: calc(var(--container-inner-width) / 3.5);
      --ig-carousel-grid: auto / auto-flow var(--ig-carousel-card-width);
    }
  }
</style>

{%- comment -%}
------------------------------------------------------------------------------------------------------------------------
LIQUID
------------------------------------------------------------------------------------------------------------------------
{%- endcomment -%}

<div {% render 'section-properties' %}>
  <div class="section-stack">
    {%- if section.settings.title != blank or section.settings.instagram_handle != blank -%}
      <div class="ig-carousel__header">
        {%- if section.settings.title != blank -%}
          <h2 class="ig-carousel__title">{{ section.settings.title }}</h2>
        {%- endif -%}

        {%- if section.settings.instagram_handle != blank -%}
          {%- if section.settings.instagram_url != blank -%}
            <a href="{{ section.settings.instagram_url }}" class="ig-carousel__handle" target="_blank" rel="noopener">
              {{ section.settings.instagram_handle }}
            </a>
          {%- else -%}
            <p class="ig-carousel__handle">{{ section.settings.instagram_handle }}</p>
          {%- endif -%}
        {%- endif -%}
      </div>
    {%- endif -%}

    <div class="floating-controls-container">
      {%- assign slider_id = 'ig-carousel-' | append: section.id -%}
      
      <scroll-carousel id="{{ slider_id }}" class="ig-carousel__grid scroll-area bleed" reveal-on-scroll="false">
        {%- for block in section.blocks -%}
          {%- liquid
            assign loading_strategy = nil
  
            if section.index > 3 or forloop.index > 3
              assign loading_strategy = 'lazy'
            endif
          -%}
          
          <div class="ig-carousel__card scroll-area__item" data-block-id="{{ block.id }}" {{ block.shopify_attributes }}>
            {%- if block.settings.image != blank -%}
              {%- if block.settings.link != blank -%}
                <a href="{{ block.settings.link }}">
                  {{- block.settings.image | image_url: width: block.settings.image.width | image_tag: loading: loading_strategy, sizes: '(max-width: 699px) 50vw, 285px', widths: '200,300,400,500,600,700,800,900,1000,1200', class: 'zoom-image' -}}
                </a>
              {%- else -%}
                {{- block.settings.image | image_url: width: block.settings.image.width | image_tag: loading: loading_strategy, sizes: '(max-width: 699px) 50vw, 285px', widths: '200,300,400,500,600,700,800,900,1000,1200', class: 'zoom-image' -}}
              {%- endif -%}
            {%- else -%}
              {{- 'image' | placeholder_svg_tag: 'placeholder' -}}
            {%- endif -%}
          </div>
        {%- endfor -%}
      </scroll-carousel>

      <button is="prev-button" class="circle-button ig-carousel-scallop-button" aria-controls="{{ slider_id }}" disabled>
        <span class="sr-only">{{ 'general.accessibility.previous' | t }}</span>
        {%- render 'icon-arrow-left-scallop' -%}
      </button>

      <button is="next-button" class="circle-button ig-carousel-scallop-button" aria-controls="{{ slider_id }}">
        <span class="sr-only">{{ 'general.accessibility.next' | t }}</span>
        {%- render 'icon-arrow-right-scallop' -%}
      </button>
    </div>
  </div>
</div>

