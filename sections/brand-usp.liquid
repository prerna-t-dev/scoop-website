{%- render 'section-spacing-collapsing' -%}

{%- comment -%}
------------------------------------------------------------------------------------------------------------------------
CSS
------------------------------------------------------------------------------------------------------------------------
{%- endcomment -%}
<style>
  #shopify-section-{{ section.id }} {
    --brand-usp-background: {{ section.settings.background_color }};
  }

  #shopify-section-{{ section.id }} .brand-usp {
    background: var(--brand-usp-background);
    padding: {{ section.settings.padding_mobile }}px 0;
  }

  #shopify-section-{{ section.id }} > div {
    padding-left: 0 !important;
    padding-right: 0 !important;
  }

  #shopify-section-{{ section.id }} .brand-usp__header {
    text-align: center;
    margin-bottom: {{ section.settings.header_spacing_mobile }}px;
    padding: 0 var(--container-gutter);
  }

  #shopify-section-{{ section.id }} .brand-usp__heading {
    font-size: {{ section.settings.heading_size_mobile }}px;
    font-weight: {{ section.settings.heading_weight }};
    color: {{ section.settings.heading_color }};
    font-family: Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    letter-spacing: {{ section.settings.heading_letter_spacing }}px;
    margin: 0;
    text-transform: uppercase;
  }

  /* Mobile Carousel */
  #shopify-section-{{ section.id }} .brand-usp__slider-wrapper {
    position: relative;
  }

  #shopify-section-{{ section.id }} .brand-usp__slider {
    display: grid;
    grid-auto-flow: column;
    grid-auto-columns: 100%;
    gap: 0;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    scroll-padding-inline: 0;
    padding: 0;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  #shopify-section-{{ section.id }} .brand-usp__slider::-webkit-scrollbar {
    display: none;
  }

  #shopify-section-{{ section.id }} .brand-usp__item {
    scroll-snap-align: start;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: {{ section.settings.item_gap_mobile }}px;
    padding: 0 var(--container-gutter);
  }

  #shopify-section-{{ section.id }} .brand-usp__item-title {
    font-size: {{ section.settings.title_size_mobile }}px;
    font-weight: {{ section.settings.title_weight }};
    color: {{ section.settings.title_color }};
    font-family: var(--heading-font-family);
    line-height: 1.3;
    margin: 0;
  }

  #shopify-section-{{ section.id }} .brand-usp__item-title p {
    margin: 0;
  }

  #shopify-section-{{ section.id }} .brand-usp__item-description {
    font-size: {{ section.settings.description_size_mobile }}px;
    line-height: 1.5;
    color: {{ section.settings.description_color }};
    font-family: var(--text-font-family);
    margin: 0;
  }

  #shopify-section-{{ section.id }} .brand-usp__item-image {
    height: auto;
    display: block;
  }

  #shopify-section-{{ section.id }} .brand-usp__item-image img {
    width: 100%;
    height: auto;
    display: block;
  }

  {%- for block in section.blocks -%}
    #shopify-section-{{ section.id }} .brand-usp__item[data-block-id="{{ block.id }}"] .brand-usp__item-image {
      width: {{ block.settings.image_width | times: 0.8 }}px;
    }

    @media screen and (min-width: 700px) {
      #shopify-section-{{ section.id }} .brand-usp__item[data-block-id="{{ block.id }}"] .brand-usp__item-image {
        width: {{ block.settings.image_width }}px;
      }
    }
  {%- endfor -%}

  /* Navigation controls at bottom */
  #shopify-section-{{ section.id }} .brand-usp__controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-top: {{ section.settings.controls_spacing_mobile }}px;
  }

  /* Pagination dots */
  #shopify-section-{{ section.id }} .brand-usp__dots {
    display: flex;
    gap: 12px;
    align-items: center;
  }

  #shopify-section-{{ section.id }} .brand-usp__dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: {{ section.settings.dot_color }};
    opacity: 0.3;
    transition: opacity 0.3s ease;
    cursor: pointer;
    border: none;
    padding: 0 !important;
  }

  #shopify-section-{{ section.id }} .brand-usp__dot.is-selected {
    opacity: 1;
  }

  /* Scallop button styling */
  #shopify-section-{{ section.id }} .circle-button.brand-usp-scallop-button {
    background: transparent !important;
    border: none !important;
    padding: 0 !important;
    cursor: pointer;
    display: inline-flex !important;
    align-items: center;
    justify-content: center;
    box-shadow: none !important;
    width: 51px !important;
    height: 51px !important;
    min-width: 51px !important;
    min-height: 51px !important;
    position: static !important;
    opacity: 1 !important;
  }

  #shopify-section-{{ section.id }} .circle-button.brand-usp-scallop-button svg {
    width: 51px !important;
    height: 51px !important;
    display: block;
    transition: transform 0.2s ease;
  }

  #shopify-section-{{ section.id }} .circle-button.brand-usp-scallop-button:hover svg {
    transform: scale(1.1);
  }

  @media screen and (min-width: 700px) {
    #shopify-section-{{ section.id }} .brand-usp {
      padding: {{ section.settings.padding_desktop }}px 0;
    }

    #shopify-section-{{ section.id }} .brand-usp__header {
      margin-bottom: {{ section.settings.header_spacing_desktop }}px;
    }

    #shopify-section-{{ section.id }} .brand-usp__heading {
      font-size: {{ section.settings.heading_size_desktop }}px;
    }

    /* Desktop Grid */
    #shopify-section-{{ section.id }} .brand-usp__slider-wrapper {
      position: static;
      padding: 0 var(--container-gutter);
    }

    #shopify-section-{{ section.id }} .brand-usp__slider {
      display: grid;
      grid-template-columns: repeat({{ section.settings.columns_desktop }}, 1fr);
      gap: {{ section.settings.column_gap_desktop }}px;
      overflow: visible;
      scroll-snap-type: none;
      padding: 0;
    }

    #shopify-section-{{ section.id }} .brand-usp__item {
      scroll-snap-align: none;
      gap: {{ section.settings.item_gap_desktop }}px;
      padding: 0;
    }

    #shopify-section-{{ section.id }} .brand-usp__item-title {
      font-size: {{ section.settings.title_size_desktop }}px;
    }

    #shopify-section-{{ section.id }} .brand-usp__item-description {
      font-size: {{ section.settings.description_size_desktop }}px;
    }

    /* Hide carousel buttons on desktop */
    #shopify-section-{{ section.id }} .brand-usp__controls {
      display: none !important;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const carousel = document.querySelector('#shopify-section-{{ section.id }} .brand-usp__slider');
    const dots = document.querySelectorAll('#shopify-section-{{ section.id }} .brand-usp__dot');
    
    if (!carousel || !dots.length) return;

    let isScrolling;

    // Update active dot based on scroll position
    function updateActiveDot() {
      const scrollLeft = carousel.scrollLeft;
      const itemWidth = carousel.querySelector('.brand-usp__item')?.offsetWidth || 0;
      const currentIndex = Math.round(scrollLeft / itemWidth);

      dots.forEach((dot, index) => {
        if (index === currentIndex) {
          dot.classList.add('is-selected');
          dot.setAttribute('aria-selected', 'true');
        } else {
          dot.classList.remove('is-selected');
          dot.setAttribute('aria-selected', 'false');
        }
      });
    }

    // Handle carousel scroll
    carousel.addEventListener('scroll', function() {
      clearTimeout(isScrolling);
      isScrolling = setTimeout(updateActiveDot, 100);
    });

    // Handle dot clicks
    dots.forEach((dot, index) => {
      dot.addEventListener('click', function() {
        const items = carousel.querySelectorAll('.brand-usp__item');
        if (items[index]) {
          items[index].scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'start' });
        }
      });
    });
  });
</script>

{%- comment -%}
------------------------------------------------------------------------------------------------------------------------
LIQUID
------------------------------------------------------------------------------------------------------------------------
{%- endcomment -%}

<div {% render 'section-properties' %}>
  <div class="brand-usp">
    {%- if section.settings.heading != blank -%}
      <div class="brand-usp__header">
        <h2 class="brand-usp__heading">{{ section.settings.heading }}</h2>
      </div>
    {%- endif -%}

    <div class="brand-usp__slider-wrapper">
      {%- assign slider_id = 'brand-usp-' | append: section.id -%}
      
      <scroll-carousel id="{{ slider_id }}" class="brand-usp__slider scroll-area is-scrollable" reveal-on-scroll="false">
        {%- for block in section.blocks -%}
          <div class="brand-usp__item scroll-area__item" data-block-id="{{ block.id }}" {{ block.shopify_attributes }}>
            {%- if block.settings.title != blank -%}
              <div class="brand-usp__item-title">{{ block.settings.title }}</div>
            {%- endif -%}

            {%- if block.settings.description != blank -%}
              <p class="brand-usp__item-description">{{ block.settings.description }}</p>
            {%- endif -%}

            {%- if block.settings.image != blank -%}
              <div class="brand-usp__item-image">
                {{- block.settings.image | image_url: width: 400 | image_tag: loading: 'lazy', widths: '120,200,300,400' -}}
              </div>
            {%- endif -%}
          </div>
        {%- endfor -%}
      </scroll-carousel>

      <div class="brand-usp__controls">
        <button is="prev-button" class="circle-button brand-usp-scallop-button" aria-controls="{{ slider_id }}">
          <span class="sr-only">{{ 'general.accessibility.previous' | t }}</span>
          {%- render 'icon-arrow-left-scallop' -%}
        </button>

        <div class="brand-usp__dots" role="tablist">
          {%- for block in section.blocks -%}
            <button 
              class="brand-usp__dot{% if forloop.first %} is-selected{% endif %}" 
              data-index="{{ forloop.index0 }}"
              role="tab"
              aria-label="Go to slide {{ forloop.index }}"
              aria-selected="{% if forloop.first %}true{% else %}false{% endif %}">
            </button>
          {%- endfor -%}
        </div>

        <button is="next-button" class="circle-button brand-usp-scallop-button" aria-controls="{{ slider_id }}">
          <span class="sr-only">{{ 'general.accessibility.next' | t }}</span>
          {%- render 'icon-arrow-right-scallop' -%}
        </button>
      </div>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Brand USP",
  "class": "shopify-section--brand-usp",
  "tag": "section",
  "disabled_on": {
    "templates": ["password"],
    "groups": ["header", "custom.overlay"]
  },
  "settings": [
    {
      "type": "header",
      "content": "Section heading"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "OUR PROMISES"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "heading_size_mobile",
      "label": "Heading size (mobile)",
      "min": 10,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 12
    },
    {
      "type": "range",
      "id": "heading_size_desktop",
      "label": "Heading size (desktop)",
      "min": 10,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 12
    },
    {
      "type": "range",
      "id": "heading_weight",
      "label": "Heading font weight",
      "min": 400,
      "max": 700,
      "step": 100,
      "default": 600
    },
    {
      "type": "range",
      "id": "heading_letter_spacing",
      "label": "Heading letter spacing",
      "min": 0,
      "max": 5,
      "step": 0.5,
      "unit": "px",
      "default": 1
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "label": "Columns (desktop)",
      "min": 2,
      "max": 6,
      "step": 1,
      "default": 4
    },
    {
      "type": "range",
      "id": "column_gap_desktop",
      "label": "Column gap (desktop)",
      "min": 20,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 40
    },
    {
      "type": "range",
      "id": "item_gap_mobile",
      "label": "Item gap (mobile)",
      "min": 10,
      "max": 40,
      "step": 2,
      "unit": "px",
      "default": 20
    },
    {
      "type": "range",
      "id": "item_gap_desktop",
      "label": "Item gap (desktop)",
      "min": 10,
      "max": 60,
      "step": 2,
      "unit": "px",
      "default": 24
    },
    {
      "type": "header",
      "content": "Item styling"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "title_size_mobile",
      "label": "Title size (mobile)",
      "min": 18,
      "max": 36,
      "step": 2,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "title_size_desktop",
      "label": "Title size (desktop)",
      "min": 20,
      "max": 48,
      "step": 2,
      "unit": "px",
      "default": 28
    },
    {
      "type": "range",
      "id": "title_weight",
      "label": "Title font weight",
      "min": 400,
      "max": 700,
      "step": 100,
      "default": 400
    },
    {
      "type": "color",
      "id": "description_color",
      "label": "Description color",
      "default": "#666666"
    },
    {
      "type": "range",
      "id": "description_size_mobile",
      "label": "Description size (mobile)",
      "min": 12,
      "max": 20,
      "step": 1,
      "unit": "px",
      "default": 14
    },
    {
      "type": "range",
      "id": "description_size_desktop",
      "label": "Description size (desktop)",
      "min": 14,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 16
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#F5F5F5"
    },
    {
      "type": "range",
      "id": "padding_mobile",
      "label": "Section padding (mobile)",
      "min": 20,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 40
    },
    {
      "type": "range",
      "id": "padding_desktop",
      "label": "Section padding (desktop)",
      "min": 40,
      "max": 200,
      "step": 10,
      "unit": "px",
      "default": 80
    },
    {
      "type": "range",
      "id": "header_spacing_mobile",
      "label": "Header spacing (mobile)",
      "min": 20,
      "max": 80,
      "step": 4,
      "unit": "px",
      "default": 32
    },
    {
      "type": "range",
      "id": "header_spacing_desktop",
      "label": "Header spacing (desktop)",
      "min": 30,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 50
    },
    {
      "type": "range",
      "id": "controls_spacing_mobile",
      "label": "Controls spacing (mobile)",
      "min": 10,
      "max": 60,
      "step": 5,
      "unit": "px",
      "default": 30
    },
    {
      "type": "color",
      "id": "dot_color",
      "label": "Pagination dot color",
      "default": "#000000"
    }
  ],
  "blocks": [
    {
      "type": "usp_item",
      "name": "USP Item",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image/Icon"
        },
        {
          "type": "range",
          "id": "image_width",
          "label": "Image width (desktop)",
          "min": 50,
          "max": 300,
          "step": 5,
          "unit": "px",
          "default": 105
        },
        {
          "type": "richtext",
          "id": "title",
          "label": "Title",
          "default": "<p>Centring Fuller-Busts</p>"
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "Description",
          "default": "Thoughtfully curated for fuller busts."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Brand USP",
      "category": "Content",
      "blocks": [
        {
          "type": "usp_item",
          "settings": {
            "title": "<p>Centring Fuller-Busts</p>",
            "description": "Thoughtfully curated for fuller busts."
          }
        },
        {
          "type": "usp_item",
          "settings": {
            "title": "<p>Fit-First Guarantee</p>",
            "description": "Every piece chosen with your fit in mind."
          }
        },
        {
          "type": "usp_item",
          "settings": {
            "title": "<p>Real Body Fittings</p>",
            "description": "Guidance that meets you, as you are."
          }
        },
        {
          "type": "usp_item",
          "settings": {
            "title": "<p>No Judgement Returns</p>",
            "description": "Send it back, no questions asked."
          }
        }
      ]
    }
  ]
}
{% endschema %}

