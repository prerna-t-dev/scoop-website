{%- render 'section-spacing-collapsing' -%}

{%- comment -%}
------------------------------------------------------------------------------------------------------------------------
CSS
------------------------------------------------------------------------------------------------------------------------
{%- endcomment -%}
<style>
  #shopify-section-{{ section.id }} .ig-carousel {
    --content-over-media-gap: var(--grid-gutter);
  }

  #shopify-section-{{ section.id }} .ig-carousel__header {
    display: flex;
    align-items: baseline;
    gap: 20px;
    margin-bottom: {{ section.settings.header_spacing_mobile }}px;
    flex-wrap: wrap;
  }

  #shopify-section-{{ section.id }} .ig-carousel__title {
    font-size: {{ section.settings.title_size_mobile }}px;
    font-weight: {{ section.settings.title_weight }};
    color: {{ section.settings.title_color }};
    font-family: var(--heading-font-family);
    font-style: italic;
    margin: 0;
  }

  #shopify-section-{{ section.id }} .ig-carousel__handle {
    font-size: {{ section.settings.handle_size_mobile }}px;
    color: {{ section.settings.handle_color }};
    font-family: var(--text-font-family);
    text-decoration: none;
    margin: 0;
  }

  #shopify-section-{{ section.id }} .ig-carousel__handle:hover {
    text-decoration: underline;
  }

  #shopify-section-{{ section.id }} .ig-carousel__grid {
    --ig-carousel-card-width: 60vw;
    --ig-carousel-grid: auto / auto-flow var(--ig-carousel-card-width);
  }

  /* Mobile Grid */
  #shopify-section-{{ section.id }} .ig-carousel__grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: {{ section.settings.gap_mobile }}px;
  }

  #shopify-section-{{ section.id }} .ig-carousel__card {
    aspect-ratio: 1 / 1 !important;
    border-radius: {{ section.settings.card_border_radius }}px;
    overflow: hidden;
    position: relative;
  }

  {%- for block in section.blocks -%}
    #shopify-section-{{ section.id }} .ig-carousel__card[data-block-id="{{ block.id }}"] {
      background: {{ block.settings.background_color }};
    }
  {%- endfor -%}

  #shopify-section-{{ section.id }} .ig-carousel__card {
    display: block;
  }

  #shopify-section-{{ section.id }} .ig-carousel__card a {
    display: block;
    width: 100%;
    height: 100%;
    aspect-ratio: 1 / 1 !important;
  }

  #shopify-section-{{ section.id }} .ig-carousel__card img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    aspect-ratio: 1 / 1 !important;
  }

  /* Scallop button styling - inherits from circle-button positioning and hover behavior */
  #shopify-section-{{ section.id }} .circle-button.ig-carousel-scallop-button {
    background: transparent !important;
    border: none !important;
    padding: 0 !important;
    cursor: pointer;
    display: none;
    align-items: center;
    justify-content: center;
    box-shadow: none !important;
    width: 51px !important;
    height: 51px !important;
    min-width: 51px !important;
    min-height: 51px !important;
  }

  #shopify-section-{{ section.id }} .circle-button.ig-carousel-scallop-button svg {
    width: 51px !important;
    height: 51px !important;
    display: block;
    filter: none !important;
  }

  @media screen and (min-width: 700px) {
    #shopify-section-{{ section.id }} .ig-carousel__header {
      margin-bottom: {{ section.settings.header_spacing_desktop }}px;
    }

    #shopify-section-{{ section.id }} .ig-carousel__title {
      font-size: {{ section.settings.title_size_desktop }}px;
    }

    #shopify-section-{{ section.id }} .ig-carousel__handle {
      font-size: {{ section.settings.handle_size_desktop }}px;
    }

    #shopify-section-{{ section.id }} .ig-carousel__grid {
      --ig-carousel-card-width: calc((100vw - var(--container-gutter) * 2) / 3.5);
      --ig-carousel-grid: auto / auto-flow var(--ig-carousel-card-width);
    }

    /* Desktop Carousel */
    #shopify-section-{{ section.id }} .ig-carousel__grid {
      display: grid;
      grid: var(--ig-carousel-grid);
      gap: {{ section.settings.gap_desktop }}px;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    #shopify-section-{{ section.id }} .ig-carousel__grid::-webkit-scrollbar {
      display: none;
    }

    #shopify-section-{{ section.id }} .ig-carousel__card {
      scroll-snap-align: start;
    }

    /* Show carousel buttons on desktop */
    #shopify-section-{{ section.id }} .circle-button.ig-carousel-scallop-button {
      display: inline-flex;
    }
  }

  @media screen and (min-width: 1000px) {
    #shopify-section-{{ section.id }} .ig-carousel__grid {
      --ig-carousel-card-width: calc(var(--container-inner-width) / 3.5);
      --ig-carousel-grid: auto / auto-flow var(--ig-carousel-card-width);
    }
  }
</style>

{%- comment -%}
------------------------------------------------------------------------------------------------------------------------
LIQUID
------------------------------------------------------------------------------------------------------------------------
{%- endcomment -%}

<div {% render 'section-properties' %}>
  <div class="section-stack">
    {%- if section.settings.title != blank or section.settings.instagram_handle != blank -%}
      <div class="ig-carousel__header">
        {%- if section.settings.title != blank -%}
          <h2 class="ig-carousel__title">{{ section.settings.title }}</h2>
        {%- endif -%}

        {%- if section.settings.instagram_handle != blank -%}
          {%- if section.settings.instagram_url != blank -%}
            <a href="{{ section.settings.instagram_url }}" class="ig-carousel__handle" target="_blank" rel="noopener">
              {{ section.settings.instagram_handle }}
            </a>
          {%- else -%}
            <p class="ig-carousel__handle">{{ section.settings.instagram_handle }}</p>
          {%- endif -%}
        {%- endif -%}
      </div>
    {%- endif -%}

    <div class="floating-controls-container">
      {%- assign slider_id = 'ig-carousel-' | append: section.id -%}
      
      <scroll-carousel id="{{ slider_id }}" class="ig-carousel__grid scroll-area bleed" reveal-on-scroll="false">
        {%- for block in section.blocks -%}
          {%- liquid
            assign loading_strategy = nil
  
            if section.index > 3 or forloop.index > 3
              assign loading_strategy = 'lazy'
            endif
          -%}
          
          <div class="ig-carousel__card scroll-area__item" data-block-id="{{ block.id }}" {{ block.shopify_attributes }}>
            {%- if block.settings.image != blank -%}
              {%- if block.settings.link != blank -%}
                <a href="{{ block.settings.link }}">
                  {{- block.settings.image | image_url: width: block.settings.image.width | image_tag: loading: loading_strategy, sizes: '(max-width: 699px) 50vw, 285px', widths: '200,300,400,500,600,700,800,900,1000,1200', class: 'zoom-image' -}}
                </a>
              {%- else -%}
                {{- block.settings.image | image_url: width: block.settings.image.width | image_tag: loading: loading_strategy, sizes: '(max-width: 699px) 50vw, 285px', widths: '200,300,400,500,600,700,800,900,1000,1200', class: 'zoom-image' -}}
              {%- endif -%}
            {%- else -%}
              {{- 'image' | placeholder_svg_tag: 'placeholder' -}}
            {%- endif -%}
          </div>
        {%- endfor -%}
      </scroll-carousel>

      <button is="prev-button" class="circle-button ig-carousel-scallop-button" aria-controls="{{ slider_id }}" disabled>
        <span class="sr-only">{{ 'general.accessibility.previous' | t }}</span>
        {%- render 'icon-arrow-left-scallop' -%}
      </button>

      <button is="next-button" class="circle-button ig-carousel-scallop-button" aria-controls="{{ slider_id }}">
        <span class="sr-only">{{ 'general.accessibility.next' | t }}</span>
        {%- render 'icon-arrow-right-scallop' -%}
      </button>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "IG Carousel",
  "class": "shopify-section--ig-carousel",
  "tag": "section",
  "disabled_on": {
    "templates": ["password"],
    "groups": ["header", "custom.overlay"]
  },
  "settings": [
    {
      "type": "header",
      "content": "Section heading"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Strap on"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "title_size_mobile",
      "label": "Title size (mobile)",
      "min": 24,
      "max": 60,
      "step": 2,
      "unit": "px",
      "default": 32
    },
    {
      "type": "range",
      "id": "title_size_desktop",
      "label": "Title size (desktop)",
      "min": 32,
      "max": 80,
      "step": 2,
      "unit": "px",
      "default": 48
    },
    {
      "type": "range",
      "id": "title_weight",
      "label": "Title font weight",
      "min": 400,
      "max": 700,
      "step": 100,
      "default": 400
    },
    {
      "type": "text",
      "id": "instagram_handle",
      "label": "Instagram handle",
      "default": "@shop_scoop_studio.in",
      "info": "e.g. @shop_scoop_studio.in"
    },
    {
      "type": "url",
      "id": "instagram_url",
      "label": "Instagram URL",
      "info": "Link to your Instagram profile"
    },
    {
      "type": "color",
      "id": "handle_color",
      "label": "Handle color",
      "default": "#999999"
    },
    {
      "type": "range",
      "id": "handle_size_mobile",
      "label": "Handle size (mobile)",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 14
    },
    {
      "type": "range",
      "id": "handle_size_desktop",
      "label": "Handle size (desktop)",
      "min": 14,
      "max": 28,
      "step": 1,
      "unit": "px",
      "default": 18
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "card_border_radius",
      "label": "Card border radius",
      "min": 0,
      "max": 50,
      "step": 2,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "gap_mobile",
      "label": "Gap (mobile)",
      "min": 8,
      "max": 40,
      "step": 2,
      "unit": "px",
      "default": 16
    },
    {
      "type": "range",
      "id": "gap_desktop",
      "label": "Gap (desktop)",
      "min": 10,
      "max": 60,
      "step": 2,
      "unit": "px",
      "default": 24
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "header_spacing_mobile",
      "label": "Header spacing (mobile)",
      "min": 20,
      "max": 60,
      "step": 4,
      "unit": "px",
      "default": 32
    },
    {
      "type": "range",
      "id": "header_spacing_desktop",
      "label": "Header spacing (desktop)",
      "min": 30,
      "max": 80,
      "step": 5,
      "unit": "px",
      "default": 50
    }
  ],
  "blocks": [
    {
      "type": "image_card",
      "name": "Image Card",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link (optional)"
        },
        {
          "type": "color",
          "id": "background_color",
          "label": "Background color",
          "default": "#F5F5F5",
          "info": "Shows if no image is uploaded"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "IG Carousel",
      "category": "Content",
      "blocks": [
        {
          "type": "image_card"
        },
        {
          "type": "image_card"
        },
        {
          "type": "image_card"
        },
        {
          "type": "image_card"
        }
      ]
    }
  ]
}
{% endschema %}

