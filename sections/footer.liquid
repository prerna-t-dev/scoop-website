{%- assign newsletter_block = section.blocks | where: 'type', 'newsletter' | first -%}
{%- assign text_block = section.blocks | where: 'type', 'text' | first -%}
{%- assign link_blocks = section.blocks | where: 'type', 'links' -%}
{%- assign policy_block = section.blocks | where: 'type', 'policy_links' | first -%}

<style>
  #shopify-section-{{ section.id }} .footer {
    background: {{ section.settings.background_color }};
    padding: var(--spacing-10) 0;
  }

  #shopify-section-{{ section.id }} .footer__container {
    max-width: {{ section.settings.max_width }}px;
    margin: 0 auto;
  }

  /* Row 1: Logo & Text + Newsletter */
  #shopify-section-{{ section.id }} .footer__row-1 {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--spacing-8);
    margin-bottom: var(--spacing-10);
  }

  #shopify-section-{{ section.id }} .footer__logo-text {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-4);
  }

  #shopify-section-{{ section.id }} .footer__logo img {
    max-width: {{ section.settings.logo_width }}px;
  }

  #shopify-section-{{ section.id }} .footer__text {
    font-size: 14px;
    line-height: 1.6;
  }

  #shopify-section-{{ section.id }} .footer__newsletter-title {
    font-size: 16px;
    font-weight: bold;
    margin-bottom: var(--spacing-4);
    text-transform: uppercase;
  }

  #shopify-section-{{ section.id }} .footer__newsletter-form {
    display: flex;
    gap: var(--spacing-3);
  }

  #shopify-section-{{ section.id }} .footer__newsletter-input {
    flex: 1;
    padding: 12px 16px;
    border: 1px solid #000;
    border-radius: 4px;
    background: transparent;
  }

  #shopify-section-{{ section.id }} .footer__newsletter-button {
    padding: 12px 24px;
    background: #000;
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    text-transform: uppercase;
  }

  /* Row 2: Links + Social & Policy */
  #shopify-section-{{ section.id }} .footer__row-2 {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--spacing-8);
    margin-bottom: var(--spacing-10);
    padding-bottom: var(--spacing-10);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  #shopify-section-{{ section.id }} .footer__links {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: var(--spacing-6);
  }

  #shopify-section-{{ section.id }} .footer__link-column h4 {
    font-size: 14px;
    font-weight: bold;
    margin-bottom: var(--spacing-3);
    text-transform: uppercase;
  }

  #shopify-section-{{ section.id }} .footer__link-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-2);
  }

  #shopify-section-{{ section.id }} .footer__link-list a {
    font-size: 14px;
    color: inherit;
    text-decoration: none;
  }

  #shopify-section-{{ section.id }} .footer__link-list a:hover {
    text-decoration: underline;
  }

  #shopify-section-{{ section.id }} .footer__social-policy {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-6);
  }

  #shopify-section-{{ section.id }} .footer__social h4 {
    font-size: 14px;
    font-weight: bold;
    margin-bottom: var(--spacing-3);
    text-transform: uppercase;
  }

  #shopify-section-{{ section.id }} .footer__social-icons {
    display: flex;
    gap: var(--spacing-4);
  }

  #shopify-section-{{ section.id }} .footer__social-icon {
    width: 24px;
    height: 24px;
  }

  #shopify-section-{{ section.id }} .footer__policy-links {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-3);
    list-style: none;
    padding: 0;
    margin: 0;
  }

  #shopify-section-{{ section.id }} .footer__policy-links a {
    font-size: 12px;
    color: inherit;
    text-decoration: none;
    text-transform: uppercase;
  }

  #shopify-section-{{ section.id }} .footer__policy-links li:not(:last-child)::after {
    content: "|";
    margin-left: var(--spacing-3);
  }

  /* Row 3: Payment + Bottom Logo + Copyright */
  #shopify-section-{{ section.id }} .footer__row-3 {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--spacing-6);
    text-align: center;
  }

  #shopify-section-{{ section.id }} .footer__payment-protection {
    font-size: 12px;
    font-weight: bold;
    text-transform: uppercase;
    margin-bottom: var(--spacing-2);
  }

  #shopify-section-{{ section.id }} .footer__payment-icons {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: var(--spacing-3);
    list-style: none;
    padding: 0;
    margin: 0;
  }

  #shopify-section-{{ section.id }} .footer__payment-icons svg {
    width: 40px;
    height: auto;
  }

  #shopify-section-{{ section.id }} .footer__bottom-logo img {
    max-width: {{ section.settings.bottom_logo_width }}px;
  }

  #shopify-section-{{ section.id }} .footer__copyright {
    font-size: 12px;
  }

  /* Desktop Layout */
  @media screen and (min-width: 750px) {
    #shopify-section-{{ section.id }} .footer__row-1 {
      grid-template-columns: 1fr 1fr;
      gap: var(--spacing-12);
    }

    #shopify-section-{{ section.id }} .footer__row-2 {
      grid-template-columns: 2fr 1fr;
      gap: var(--spacing-12);
    }

    #shopify-section-{{ section.id }} .footer__links {
      grid-template-columns: repeat(3, 1fr);
    }

    #shopify-section-{{ section.id }} .footer__social-policy {
      align-items: flex-end;
      text-align: right;
    }

    #shopify-section-{{ section.id }} .footer__policy-links {
      justify-content: flex-end;
    }
  }
</style>

<div class="footer">
  <div class="footer__container">
    {%- comment -%}
    ------------------------------------------------------------------------------------------------------------------
    ROW 1: LOGO & TEXT + NEWSLETTER
    ------------------------------------------------------------------------------------------------------------------
    {%- endcomment -%}
    <div class="footer__row-1">
      <div class="footer__logo-text">
        {%- if section.settings.logo != blank -%}
          <div class="footer__logo">
            {%- capture sizes -%}{{ section.settings.logo_width }}px{%- endcapture -%}
            {%- capture widths -%}{{ section.settings.logo_width }}, {{ section.settings.logo_width | times: 2 | at_most: section.settings.logo.width }}{%- endcapture -%}
            {{- section.settings.logo | image_url: width: section.settings.logo.width | image_tag: loading: 'lazy', sizes: sizes, widths: widths -}}
          </div>
        {%- endif -%}

        {%- if text_block != blank and text_block.settings.content != blank -%}
          <div class="footer__text">
            {{- text_block.settings.content -}}
          </div>
        {%- endif -%}
      </div>

      {%- if newsletter_block != blank -%}
        <div class="footer__newsletter">
          {%- if newsletter_block.settings.title != blank -%}
            <div class="footer__newsletter-title">{{ newsletter_block.settings.title }}</div>
          {%- endif -%}

          {%- form 'customer', id: 'footer-newsletter', class: 'footer__newsletter-form form' -%}
            {%- if form.posted_successfully? -%}
              {%- capture success_message -%}{{ 'general.newsletter.subscribed_successfully' | t }}{%- endcapture -%}
              {%- render 'banner', content: success_message, status: 'success' -%}
            {%- else -%}
              {%- if form.errors -%}
                {%- capture error_message -%}{{ form.errors.translated_fields['email'] }} {{ form.errors.messages['email'] }}{%- endcapture -%}
                {%- render 'banner', content: error_message, status: 'error' -%}
              {%- endif -%}

              <input type="hidden" name="contact[tags]" value="newsletter">
              <input type="email" name="contact[email]" class="footer__newsletter-input" placeholder="{{ newsletter_block.settings.placeholder | default: 'EMAIL ID' }}" required autocomplete="email">
              <button type="submit" class="footer__newsletter-button">{{ newsletter_block.settings.button_text | default: 'SIGN UP' }}</button>
            {%- endif -%}
          {%- endform -%}
        </div>
      {%- endif -%}
    </div>

    {%- comment -%}
    ------------------------------------------------------------------------------------------------------------------
    ROW 2: LINKS + SOCIAL & POLICY
    ------------------------------------------------------------------------------------------------------------------
    {%- endcomment -%}
    <div class="footer__row-2">
      <div class="footer__links">
        {%- for block in link_blocks -%}
          {%- if block.settings.menu != blank -%}
            <div class="footer__link-column" {{ block.shopify_attributes }}>
              {%- if block.settings.show_menu_title -%}
                <h4>{{ block.settings.menu_title | default: block.settings.menu.title }}</h4>
              {%- endif -%}

              <ul class="footer__link-list">
                {%- for link in block.settings.menu.links -%}
                  <li>
                    <a href="{{ link.url }}">{{ link.title }}</a>
                  </li>
                {%- endfor -%}
              </ul>
            </div>
          {%- endif -%}
        {%- endfor -%}
      </div>

      <div class="footer__social-policy">
        {%- if section.settings.show_social_media -%}
          <div class="footer__social">
            <h4>CONNECT</h4>
            <div class="footer__social-icons">
              {%- render 'social-media' -%}
            </div>
          </div>
        {%- endif -%}

        {%- if policy_block != blank -%}
          <ul class="footer__policy-links">
            {%- for link in policy_block.settings.menu.links -%}
              <li>
                <a href="{{ link.url }}">{{ link.title }}</a>
              </li>
            {%- endfor -%}
          </ul>
        {%- endif -%}
      </div>
    </div>

    {%- comment -%}
    ------------------------------------------------------------------------------------------------------------------
    ROW 3: PAYMENT INFO + BOTTOM LOGO + COPYRIGHT
    ------------------------------------------------------------------------------------------------------------------
    {%- endcomment -%}
    <div class="footer__row-3">
      {%- if section.settings.show_payment_icons and shop.enabled_payment_types.size > 0 -%}
        <div>
          {%- if section.settings.payment_protection_text != blank -%}
            <div class="footer__payment-protection">{{ section.settings.payment_protection_text }}</div>
          {%- endif -%}
          <ul class="footer__payment-icons">
            {%- for type in shop.enabled_payment_types -%}
              <li>{{ type | payment_type_svg_tag }}</li>
            {%- endfor -%}
          </ul>
        </div>
      {%- endif -%}

      {%- if section.settings.bottom_logo != blank -%}
        <div class="footer__bottom-logo">
          {%- capture sizes -%}{{ section.settings.bottom_logo_width }}px{%- endcapture -%}
          {%- capture widths -%}{{ section.settings.bottom_logo_width }}, {{ section.settings.bottom_logo_width | times: 2 | at_most: section.settings.bottom_logo.width }}{%- endcapture -%}
          {{- section.settings.bottom_logo | image_url: width: section.settings.bottom_logo.width | image_tag: loading: 'lazy', sizes: sizes, widths: widths -}}
        </div>
      {%- endif -%}

      <div class="footer__copyright">
        <p>© {{ 'now' | date: '%Y' }}, {{ shop.name }}. All rights reserved.</p>
      </div>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Footer",
  "class": "shopify-section--footer",
  "tag": "footer",
  "max_blocks": 10,
  "settings": [
    {
      "type": "header",
      "content": "Top Logo"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo image"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 50,
      "max": 300,
      "step": 10,
      "unit": "px",
      "label": "Logo width",
      "default": 150
    },
    {
      "type": "header",
      "content": "Bottom Logo (Scoop)"
    },
    {
      "type": "image_picker",
      "id": "bottom_logo",
      "label": "Bottom logo image"
    },
    {
      "type": "range",
      "id": "bottom_logo_width",
      "min": 100,
      "max": 400,
      "step": 10,
      "unit": "px",
      "label": "Bottom logo width",
      "default": 200
    },
    {
      "type": "header",
      "content": "Footer styling"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#CCA7FC"
    },
    {
      "type": "range",
      "id": "max_width",
      "min": 800,
      "max": 1400,
      "step": 10,
      "unit": "px",
      "label": "Max width",
      "default": 990
    },
    {
      "type": "header",
      "content": "Footer content"
    },
    {
      "type": "checkbox",
      "id": "show_social_media",
      "label": "Show social media",
      "info": "To configure social media, go to your social media settings.",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_payment_icons",
      "label": "Show payment icons",
      "default": true
    },
    {
      "type": "text",
      "id": "payment_protection_text",
      "label": "Payment protection text",
      "default": "100% PAYMENT PROTECTION. EASY RETURN POLICY"
    }
  ],
  "blocks": [
    {
      "type": "@app"
    },
    {
      "type": "text",
      "name": "Text",
      "limit": 1,
      "settings": [
        {
          "type": "richtext",
          "id": "content",
          "label": "Content",
          "default": "<p>A premium lingerie studio where fuller busts find their perfect fit. Thoughtfully crafted innerwear designed and curated with you in mind.</p>"
        }
      ]
    },
    {
      "type": "links",
      "name": "Links",
      "settings": [
        {
          "type": "link_list",
          "id": "menu",
          "label": "Menu",
          "info": "This menu won't show dropdown items.",
          "default": "footer"
        },
        {
          "type": "checkbox",
          "id": "show_menu_title",
          "label": "Show menu title",
          "default": true
        },
        {
          "type": "inline_richtext",
          "id": "menu_title",
          "label": "Menu title",
          "info": "Replaces the default menu title"
        }
      ]
    },
    {
      "type": "policy_links",
      "name": "Policy Links",
      "limit": 1,
      "settings": [
        {
          "type": "link_list",
          "id": "menu",
          "label": "Policy menu",
          "info": "Add your policy links here"
        }
      ]
    },
    {
      "type": "newsletter",
      "name": "Newsletter",
      "limit": 1,
      "settings": [
        {
          "type": "paragraph",
          "content": "Customers who subscribe will have their email address added to the \"accepts marketing\" [customer list](/admin/customers?query=&accepts_marketing=1)."
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "GET THE INSIDE SCOOP"
        },
        {
          "type": "text",
          "id": "placeholder",
          "label": "Input placeholder",
          "default": "EMAIL ID"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Button text",
          "default": "SIGN UP"
        }
      ]
    }
  ]
}
{% endschema %}
