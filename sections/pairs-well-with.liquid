{%- render 'section-spacing-collapsing' -%}

{%- comment -%}
------------------------------------------------------------------------------------------------------------------------
CSS
------------------------------------------------------------------------------------------------------------------------
{%- endcomment -%}
<style>
  #shopify-section-{{ section.id }} {
    padding-top: 44px !important;
  }

  #shopify-section-{{ section.id }} .section-header h2 {
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    font-weight: 400;
    line-height: 100%;
    color: {{ section.settings.heading_color | default: '#7E7E7E' }};
    margin: 0;
  }

  @media screen and (min-width: 700px) {
    #shopify-section-{{ section.id }} .section-header h2 {
      font-size: 22px;
    }
  }

  #shopify-section-{{ section.id }} .pairs-well-with-list {
    --product-item-width: 280px;
    --product-grid: auto / auto-flow var(--product-item-width);
    display: grid;
    grid: var(--product-grid);
    gap: var(--spacing-4);
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  #shopify-section-{{ section.id }} .pairs-well-with-list::-webkit-scrollbar {
    display: none;
  }

  #shopify-section-{{ section.id }} .pairs-well-with-list.bleed {
    padding-inline-end: 0 !important;
    margin-inline-end: 0 !important;
  }

  #shopify-section-{{ section.id }} .pairs-well-with-list__item {
    scroll-snap-align: start;
    border-radius: 16px;
    overflow: hidden;
    position: relative;
    background-color: #F8EEEC;
    border: 1px solid #f0f0f0;
    padding: 12px;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    width: 280px;
  }

  #shopify-section-{{ section.id }} .pairs-well-with-list__item .product-image-wrapper{
    height: 100%;
    border-radius: 10px;
    aspect-ratio: 1 / 1;
    overflow: hidden;
    max-width: 120px;
    max-height: 150px;
  }

  #shopify-section-{{ section.id }} .pairs-well-with-list__item .product-image {
    width: 100%;
    /* aspect-ratio: 1 / 1; */
    object-fit: cover;
    
    flex-shrink: 0;
  }

  #shopify-section-{{ section.id }} .pairs-well-with-list__item .product-content {
    width: 100%;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  #shopify-section-{{ section.id }} .pairs-well-with-list__item .product-title {
    font-size: 16px;
    font-weight: 400;
    line-height: 1.3;
    color: #000000;
    margin: 0 0 8px 0;
    text-align: left;
    display: block;
    text-decoration: none;
  }

  #shopify-section-{{ section.id }} .pairs-well-with-list__item .product-price {
    font-size: 10px;
    font-weight: 500;
    color: #000000;
    margin: 0;
  }

  #shopify-section-{{ section.id }} .pairs-well-with-list__item .color-swatches {
    display: flex;
    gap: 8px;
    margin: 0;
  }

  #shopify-section-{{ section.id }} .pairs-well-with-list__item .price-swatches-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
  }

  #shopify-section-{{ section.id }} .pairs-well-with-list__item .color-swatch--small-svg {
    /* width: 24px;
    height: 24px; */
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  #shopify-section-{{ section.id }} .pairs-well-with-list__item .color-swatch--small-svg svg {
    width: 13px;
    height: 14px;
  }

  #shopify-section-{{ section.id }} .pairs-well-with-list__item .add-to-cart-btn {
    width: 100%;
    background-color: #ffffff;
    color: #000000;
    border: 1px solid transparent;
    border-radius: 6px;
    padding: 12px;
    font-size: 10px;
    font-weight: 400;
    text-align: center;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s ease-in-out;
    height: 32px;
    white-space: nowrap;
    padding: 0 !important;
  }

  #shopify-section-{{ section.id }} .pairs-well-with-list__item .add-to-cart-btn:hover {
    background-color: #f8f8f8;
  }

  @media screen and (min-width: 700px) {
    #shopify-section-{{ section.id }} .pairs-well-with-list {
      --product-item-width: 380px;
    }
    #shopify-section-{{ section.id }} .pairs-well-with-list__item {
      /* width: 380px; */
      width: 100%;
    }

    #shopify-section-{{ section.id }} .pairs-well-with-list__item .product-image-wrapper{
    border-radius: 12px;
    max-width: 150px;
    max-height: 150px;
    }

    #shopify-section-{{ section.id }} .pairs-well-with-list__item .product-image {
      
    }

    #shopify-section-{{ section.id }} .pairs-well-with-list__item .product-title {
      font-size: 20px;
    }

    #shopify-section-{{ section.id }} .pairs-well-with-list__item .product-price {
      font-size: 13px;
    }

    #shopify-section-{{ section.id }} .pairs-well-with-list__item .add-to-cart-btn {
      font-size: 14px;
    }
  }

  #shopify-section-{{ section.id }} .section-full {
      padding-right: 0!important;
    }

  @media screen and (min-width: 1000px) {
    #shopify-section-{{ section.id }} .pairs-well-with-list {
      --product-item-width: calc(var(--container-inner-width) / 3.5);
      gap: 24px;
    }

    #shopify-section-{{ section.id }} .section-full {
      padding-left: 24px !important;
      padding-right: 0!important;
    }
  }

  @media screen and (min-width: 1200px) {
    #shopify-section-{{ section.id }} .section-full {
      padding-left: 212px !important;
    }
  }

  /* Scallop button styling - inherits from circle-button positioning and hover behavior */
  #shopify-section-{{ section.id }} .circle-button.pairs-scallop-button {
    background: transparent !important;
    border: none !important;
    padding: 0 !important;
    cursor: pointer;
    display: inline-flex !important;
    align-items: center;
    justify-content: center;
    box-shadow: none !important;
    width: 51px !important;
    height: 51px !important;
    min-width: 51px !important;
    min-height: 51px !important;
  }

  #shopify-section-{{ section.id }} .circle-button.pairs-scallop-button svg {
    width: 51px !important;
    height: 51px !important;
    display: block;
    filter: none !important;
  }

  .scroll-area__item a{
    display: block;
    /* min-width: 130px */
  }
</style>

{%- comment -%}
------------------------------------------------------------------------------------------------------------------------
LIQUID
------------------------------------------------------------------------------------------------------------------------
{%- endcomment -%}

<div {% render 'section-properties' %}>
  <div class="section-stack">
    {%- render 'section-header', subheading: section.settings.subheading, heading: section.settings.title, heading_color: section.settings.heading_color -%}

    {%- if section.settings.collection != blank and section.settings.collection.products.size > 0 -%}
      <div class="floating-controls-container">
        {%- assign scroll_area_id = 'scroll-area-' | append: section.id -%}

        <scroll-carousel id="{{ scroll_area_id }}" class="pairs-well-with-list scroll-area bleed">
          {%- assign products_to_show = section.settings.collection.products | limit: 6 -%}
          {%- for product in products_to_show -%}
            <div class="scroll-area__item pairs-well-with-list__item group" data-product-id="{{ product.id }}">
              {%- assign featured_image = product.featured_media | default: product.media.first -%}
              {%- if featured_image != blank -%}
                <a class="product-image-wrapper" href="{{ product.url }}">
                  {{ featured_image | image_url: width: 300 | image_tag: class: 'product-image', loading: 'lazy' }}
                </a>
              {%- endif -%}

              <div class="product-content">
                <div>
                  <a href="{{ product.url }}" class="product-title">{{ product.title }}</a>
                  
                  <div class="price-swatches-container">
                    <div class="product-price">
                      {%- render 'price-list', product: product, variant: product.selected_or_first_available_variant -%}
                    </div>

                    {%- comment -%} Color swatches - use same logic as variant-picker {%- endcomment -%}
                    {%- assign color_label_list = 'general.label.color' | t | replace: ', ', ',' | downcase | split: ',' -%}
                    {%- assign color_option = blank -%}
                    
                    {%- for option in product.options_with_values -%}
                      {%- assign option_downcase = option.name | downcase -%}
                      {%- if color_label_list contains option_downcase -%}
                        {%- assign color_option = option -%}
                        {%- break -%}
                      {%- endif -%}
                    {%- endfor -%}
                    
                    {%- if color_option != blank and color_option.values.size > 0 -%}
                      <div class="color-swatches"> 
                        {%- for color_value in color_option.values limit: 3 -%}
                          {%- assign color_variant = blank -%}
                          {%- for variant in product.variants -%}
                            {%- assign option_position = color_option.position | minus: 1 -%}
                            {%- if variant.options[option_position] == color_value.name -%}
                              {%- assign color_variant = variant -%}
                              {%- break -%}
                            {%- endif -%}
                          {%- endfor -%}
                          {%- if color_variant != blank -%}
                            <a href="{{ color_variant.url }}" class="color-swatch--small-svg" title="{{ color_value.name }}">
                              <svg width="13" height="14" viewBox="0 0 13 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12.75 10.0645C12.75 12.0374 11.1537 13.6365 9.18555 13.6367C8.21946 13.6367 7.34351 13.2516 6.70117 12.626L6.52637 12.4561L6.35156 12.626C5.70923 13.2515 4.83326 13.6367 3.86719 13.6367C1.89905 13.6365 0.302734 12.0374 0.302734 10.0645C0.302852 9.08953 0.693038 8.20617 1.3252 7.56152L1.49609 7.38672L1.3252 7.21191C0.693038 6.56727 0.302851 5.68391 0.302734 4.70898C0.302734 2.73603 1.89905 1.13696 3.86719 1.13672C4.83327 1.13672 5.70923 1.5219 6.35156 2.14746L6.52637 2.31738L6.70117 2.14746C7.3435 1.52189 8.21946 1.13672 9.18555 1.13672C11.1537 1.1369 12.75 2.736 12.75 4.70898C12.7499 5.68386 12.3606 6.56728 11.7285 7.21191L11.5566 7.38672L11.7285 7.56152C12.3606 8.20615 12.7499 9.08958 12.75 10.0645Z" fill="{{ color_value.name | downcase }}" stroke="black" stroke-width="0.5"/>
                              </svg>
                            </a>
                          {%- endif -%}
                        {%- endfor -%}
                      </div>
                    {%- endif -%}
                  </div>
                </div>

                <button class="add-to-cart-btn" onclick="window.location.href='{{ product.url }}'">
                  ADD TO CART
                </button>
              </div>
            </div>
          {%- endfor -%}
        </scroll-carousel>

        <button is="prev-button" class="circle-button pairs-scallop-button" aria-controls="{{ scroll_area_id }}" disabled>
          <span class="sr-only">{{ 'general.accessibility.previous' | t }}</span>
          {%- render 'icon-arrow-left-scallop' -%}
        </button>

        <button is="next-button" class="circle-button pairs-scallop-button" aria-controls="{{ scroll_area_id }}">
          <span class="sr-only">{{ 'general.accessibility.next' | t }}</span>
          {%- render 'icon-arrow-right-scallop' -%}
        </button>
      </div>
    {%- else -%}
      <div class="pairs-well-with-list">
        <p>No products found in the selected collection.</p>
      </div>
    {%- endif -%}
  </div>
</div>

{% schema %}
{
  "name": "Pairs well with",
  "class": "shopify-section--pairs-well-with",
  "tag": "section",
  "disabled_on": {
    "templates": ["password"],
    "groups": ["header", "custom.overlay"]
  },
  "settings": [
    {
      "type": "header",
      "content": "Section header"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "Pairs well with"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading color",
      "default": "#7E7E7E"
    },
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection",
      "info": "Select a collection to display products from"
    }
  ],
  "presets": [
    {
      "name": "Pairs well with",
      "category": "Product"
    }
  ]
}
{% endschema %}
