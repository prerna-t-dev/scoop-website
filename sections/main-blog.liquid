{%- render 'section-spacing-collapsing' -%}

<style>
  #shopify-section-{{ section.id }} {
    {%- if section.settings.allow_transparent_header -%}
      --banner-spacing-block-added: var(--header-height);

      margin-block-start: calc(-1 * var(--header-height) * var(--section-is-first));
    {%- endif -%}
    --banner-content-padding-block-start: {%- if section.settings.allow_transparent_header -%}var(--spacing-12){% else %}var(--spacing-16){% endif %};
  }

  @media screen and (min-width: 700px) {
    #shopify-section-{{ section.id }} {
      --banner-content-padding-block-start: {%- if section.settings.allow_transparent_header -%}var(--spacing-18){% else %}var(--spacing-28){% endif %};
    }
  }
</style>

<div class="blog" {% if section.settings.allow_transparent_header %}allow-transparent-header{% endif %}>
  {%- if blog.articles_count == 0 -%}
    <div class="empty-state">
      <div class="empty-state__icon-wrapper">
        {%- render 'icon' with 'picto-comment', width: 32, height: 32, stroke_width: 1 -%}
      </div>

      <div class="prose">
        <h1 class="h4">{{ 'blog.general.empty_blog' | t }}</h1>

        {%- assign button_content = 'blog.general.back_to_home' | t -%}
        {%- render 'button', size: 'xl', content: button_content, href: routes.root_url -%}
      </div>
    </div>
  {%- else -%}
    <header class="blog-banner">
      {%- comment -%} Split Image Hero Section {%- endcomment -%}
      <div class="blog-banner__hero">
        {%- comment -%} Left Purple Graphic Panel {%- endcomment -%}
        <div class="blog-banner__left-panel">
          {%- if section.settings.left_panel_image != blank -%}
            {{ section.settings.left_panel_image | image_url: width: 800 | image_tag: loading: 'eager', class: 'blog-banner__left-image', alt: 'Blog banner left' }}
          {%- else -%}
            <div class="blog-banner__real-talk-overlay">
              <span class="blog-banner__real-text">Real</span>
              <span class="blog-banner__talk-text">Talk</span>
            </div>
          {%- endif -%}
        </div>
        
        {%- comment -%} Right Image Panel {%- endcomment -%}
        <div class="blog-banner__right-panel">
          {%- if section.settings.hero_image != blank -%}
            {{ section.settings.hero_image | image_url: width: 800 | image_tag: loading: 'eager', class: 'blog-banner__hero-image', sizes: '(max-width: 699px) 100vw, 50vw' }}
          {%- else -%}
            <div class="blog-banner__hero-placeholder"></div>
          {%- endif -%}
          
          {%- comment -%} Mobile Logo Overlay {%- endcomment -%}
          {%- if section.settings.real_talk_logo_mobile != blank -%}
            <div class="blog-banner__real-talk-overlay-mobile">
              {{ section.settings.real_talk_logo_mobile | image_url: width: 400 | image_tag: loading: 'eager', class: 'blog-banner__real-talk-logo', alt: 'Real Talk' }}
            </div>
          {%- endif -%}
        </div>
      </div>

      {%- comment -%} Newsletter CTA Box {%- endcomment -%}
      <div class="container">
        <div class="blog-banner__cta-box">
          {%- if section.settings.cta_title != blank -%}
            <h2 class="blog-banner__cta-title">{{ section.settings.cta_title }}</h2>
          {%- endif -%}

          {%- if section.settings.cta_content != blank -%}
            <div class="blog-banner__cta-content">
              {{ section.settings.cta_content }}
            </div>
          {%- endif -%}

          {%- if section.settings.show_newsletter_form -%}
            {%- form 'customer', id: 'blog-newsletter', class: 'blog-banner__form form' -%}
              {%- if form.posted_successfully? -%}
                {%- capture success_message -%}{{ 'general.newsletter.subscribed_successfully' | t }}{%- endcapture -%}
                {%- render 'banner', content: success_message, status: 'success' -%}
              {%- else -%}
                {%- if form.errors -%}
                  {%- assign content = form.errors | default_errors -%}
                  {%- render 'banner', status: 'error', content: content -%}
                {%- endif -%}
              {%- endif -%}

              <input type="hidden" name="contact[tags]" value="newsletter">

              <div class="blog-banner__form-fields">
                {%- assign label = 'blog.comments.email' | t -%}

                {%- render 'input', type: 'email', name: 'contact[email]', label: label, value: customer.email, required: true, autocomplete: 'email', placeholder: 'EMAIL ID' -%}
                {%- render 'button', content: 'SIGN UP', type: 'submit', size: 'xl', background: section.settings.button_background, text_color: section.settings.button_text_color -%}
              </div>
            {%- endform -%}
          {%- endif -%}
        </div>
      </div>

      {%- comment -%} Category Tags {%- endcomment -%}
      {%- if section.settings.show_tags -%}
        <div class="blog-category-tags">
          <ul class="blog-category-tags__list" role="tablist">
            {%- for block in section.blocks -%}
              {%- case block.type -%}
                {%- when 'category' -%}
                  <li role="tab" {% if block.settings.tag_name == 'All' %}aria-selected="{% if current_tags == blank %}true{% else %}false{% endif %}"{% else %}aria-selected="{% if current_tags contains block.settings.tag_name %}true{% else %}false{% endif %}"{% endif %}>
                    {%- if block.settings.tag_name == 'All' -%}
                      <a href="{{ blog.url }}" class="blog-category-tags__tag {% if current_tags == blank %}blog-category-tags__tag--active{% endif %}" style="{% if current_tags == blank %}background: {{ block.settings.tag_active_color }}; color: white;{% else %}background: {{ block.settings.tag_color }};{% endif %}">
                        {{ block.settings.display_name | default: 'All' }}
                      </a>
                    {%- else -%}
                      {%- assign tag_link = blog.url | append: '/tagged/' | append: block.settings.tag_name | replace: ' ', '-' -%}
                      <a href="{{ tag_link }}" class="blog-category-tags__tag {% if current_tags contains block.settings.tag_name %}blog-category-tags__tag--active{% endif %}" style="{% if current_tags contains block.settings.tag_name %}background: {{ block.settings.tag_active_color }}; color: white;{% else %}background: {{ block.settings.tag_color }};{% endif %}">
                        {{ block.settings.display_name }}
                      </a>
                    {%- endif -%}
                  </li>
              {%- endcase -%}
            {%- endfor -%}
          </ul>
        </div>
      {%- endif -%}
    </header>

    {%- comment -%} Search and Sort Section {%- endcomment -%}
    <div class="blog-search-sort">
      <div class="container">
        <div class="blog-search-sort__wrapper">
          {%- comment -%} Search Input {%- endcomment -%}
          <div class="blog-search-sort__search">
            <form action="{{ blog.url }}" method="get" class="blog-search-form">
              <input type="search" name="q" value="{{ search.terms }}" placeholder="SEARCH BLOGS" class="blog-search-input" aria-label="Search blogs">
            </form>
          </div>

          {%- comment -%} Sort Dropdown {%- endcomment -%}
          <div class="blog-search-sort__controls">
            <p class="blog-search-sort__count">{{ paginate.items }} {% if paginate.items == 1 %}Blog{% else %}Blogs{% endif %}</p>
            
            <select class="blog-search-sort__select" onchange="window.location.href=this.value">
              <option value="{{ blog.url }}{% if search.terms %}?q={{ search.terms }}{% endif %}">ALPHABETICALLY</option>
              <option value="{{ blog.url }}{% if search.terms %}?q={{ search.terms }}&{% else %}?{% endif %}sort_by=created-descending">NEWEST FIRST</option>
              <option value="{{ blog.url }}{% if search.terms %}?q={{ search.terms }}&{% else %}?{% endif %}sort_by=title-ascending">TITLE A-Z</option>
              <option value="{{ blog.url }}{% if search.terms %}?q={{ search.terms }}&{% else %}?{% endif %}sort_by=title-descending">TITLE Z-A</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <div class="blog-posts__container container">
      {%- if search.performed -%}
        {%- comment -%} Show search results {%- endcomment -%}
        {%- if search.articles.size > 0 -%}
          <div class="blog-posts">
            {%- for article in search.articles -%}
              {%- assign article_index = forloop.index -%}
              {%- capture sizes -%}(max-width: 699px) 100vw, (max-width: 1149px) calc(100vw / 2 - 40px), (max-width: 1399px) calc(min(100vw, {{ settings.page_width }}px) / 3 - 40px) , calc(min(100vw, {{ settings.page_width }}px) / 3 - 80px) {%- endcapture -%}
              {%- render 'blog-post-card', article: article, show_excerpt: section.settings.show_excerpt, show_date: section.settings.show_date, show_author: section.settings.show_author, show_comments_count: section.settings.show_comments_count, show_category: section.settings.show_category, sizes: sizes, position: forloop.index, section: section -%}
            {%- endfor -%}
          </div>
        {%- else -%}
          <div class="blog-search-no-results">
            <p>No results found for "{{ search.terms }}".</p>
          </div>
        {%- endif -%}
      {%- else -%}
        {%- comment -%} Show regular blog articles with pagination {%- endcomment -%}
        {%- paginate blog.articles by section.settings.articles_per_page -%}
          <div class="blog-posts">
            {%- for article in blog.articles -%}
            {%- assign article_index = forloop.index -%}

            {%- if section.blocks.size > 0 -%}
              {%- for block in section.blocks -%}
                {%- assign block_position = block.settings.position | at_most: section.settings.articles_per_page -%}

                {%- if block_position == article_index -%}
                  <div {% render 'surface', class: 'blog-posts-newsletter v-stack gap-6 sm:gap-8 text-center rounded', text_color: block.settings.text_color, background: block.settings.background, background_fallback: 'bg-secondary' %}>
                    <div class="blog-posts-newsletter__content v-stack gap-4 justify-items-center sm:gap-6">
                      {%- render 'icon' with 'picto-envelope', width: 24, height: 24 -%}

                      {%- if block.settings.title != blank -%}
                        <p class="h4">{{- block.settings.title -}}</p>
                      {%- endif -%}

                      {%- if block.settings.content != blank -%}
                        <div class="prose">
                          {{- block.settings.content -}}
                        </div>
                      {%- endif -%}
                    </div>

                    {%- form 'customer', id: 'blog-posts-newsletter-form', class: 'form form--tight' -%}
                      <div class="fieldset">
                        {%- if form.posted_successfully? -%}
                          {%- capture success_message -%}{{ 'general.newsletter.subscribed_successfully' | t }}{%- endcapture -%}
                          {%- render 'banner', content: success_message, status: 'success' -%}
                        {%- else -%}
                          {%- if form.errors -%}
                            {%- assign content = form.errors | default_errors -%}
                            {%- render 'banner', status: 'error', content: content -%}
                          {%- endif -%}
                        {%- endif -%}

                        <input type="hidden" name="contact[tags]" value="newsletter">

                        {%- assign label = 'blog.comments.email' | t -%}
                        {%- render 'input', type: 'email', name: 'contact[email]', label: label, value: customer.email, required: true, autocomplete: 'email' -%}
                      </div>

                      {%- render 'button', content: block.settings.button_text, icon: 'picto-envelope', type: 'submit', size: 'xl', secondary: true -%}
                    {%- endform -%}

                    {%- if block.settings.subtext != blank -%}
                      <p class="text-sm text-subdued">{{- block.settings.subtext -}}</p>
                    {%- endif -%}
                  </div>
                {%- endif -%}
              {%- endfor -%}
            {%- endif -%}

            {%- if section.settings.feature_first_article and forloop.first -%}
              {%- assign background_color = article.metafields.banner.background_color.value | default: section.settings.feature_article_background -%}
              {%- assign text_color = article.metafields.banner.text_color.value | default: section.settings.feature_article_text_color -%}
              {%- capture sizes -%}(max-width: 999px) 100vw, calc(min(100vw, {{ settings.page_width }}px) * 0.65){%- endcapture -%}
              {%- render 'blog-post-card', article: article, featured: section.settings.feature_first_article, show_excerpt: section.settings.show_excerpt, show_date: section.settings.show_date, show_author: section.settings.show_author, show_comments_count: section.settings.show_comments_count, show_category: section.settings.show_category, background: background_color, text_color: text_color, sizes: sizes, position: forloop.index, section: section -%}
            {%- else -%}
              {%- capture sizes -%}(max-width: 699px) 100vw, (max-width: 1149px) calc(100vw / 2 - 40px), (max-width: 1399px) calc(min(100vw, {{ settings.page_width }}px) / 3 - 40px) , calc(min(100vw, {{ settings.page_width }}px) / 3 - 80px) {%- endcapture -%}
              {%- render 'blog-post-card', article: article, show_excerpt: section.settings.show_excerpt, show_date: section.settings.show_date, show_author: section.settings.show_author, show_comments_count: section.settings.show_comments_count, show_category: section.settings.show_category, sizes: sizes, position: forloop.index, section: section -%}
            {%- endif -%}
          {%- endfor -%}
          </div>
          {%- render 'pagination', paginate: paginate -%}
        {%- endpaginate -%}
      {%- endif -%}
    </div>
  {%- endif -%}
</div>

{% schema %}
{
  "name": "Blog",
  "class": "shopify-section--main-blog",
  "tag": "section",
  "blocks": [
    {
      "type": "newsletter",
      "name": "Newsletter",
      "limit": 1,
      "settings": [
        {
          "type": "paragraph",
          "content": "Customers who subscribe will have their email address added to the \"accepts marketing\" [customer list](/admin/customers?query=&accepts_marketing=1)."
        },
        {
          "type": "text",
          "id": "title",
          "label": "Heading",
          "default": "Newsletter"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Content",
          "default": "<p>Write something about what your customers will receive by subscribing to your newsletter.</p>"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Button",
          "default": "Subscribe"
        },
        {
          "type": "text",
          "id": "subtext",
          "label": "Subtext"
        },
        {
          "type": "range",
          "id": "position",
          "label": "Position in grid",
          "min": 1,
          "max": 24,
          "step": 1,
          "default": 5
        },
        {
          "type": "header",
          "content": "Colors"
        },
        {
          "type": "color",
          "id": "background",
          "label": "Background"
        },
        {
          "type": "color",
          "id": "text_color",
          "label": "Text"
        }
      ]
    },
    {
      "type": "category",
      "name": "Category Tag",
      "settings": [
        {
          "type": "text",
          "id": "tag_name",
          "label": "Tag Name",
          "info": "Use 'All' for the all posts button, or enter the exact tag name from your blog posts"
        },
        {
          "type": "text",
          "id": "display_name",
          "label": "Display Name",
          "info": "The text that will appear on the button"
        },
        {
          "type": "color",
          "id": "tag_color",
          "label": "Tag Background Color",
          "default": "#EBDCFF"
        },
        {
          "type": "color",
          "id": "tag_active_color",
          "label": "Tag Active Background Color",
          "default": "#A073B7"
        }
      ]
    }
  ],
  "settings": [
    {
      "type": "header",
      "content": "Banner"
    },
    {
      "type": "checkbox",
      "id": "allow_transparent_header",
      "label": "Allow transparent header",
      "info": "This setting only applies when this section is the first one.",
      "default": false
    },
    {
      "type": "image_picker",
      "id": "left_panel_image",
      "label": "Left Panel Image (Desktop)",
      "info": "Optional image for left panel. If not set, displays 'Real Talk' text."
    },
    {
      "type": "image_picker",
      "id": "hero_image",
      "label": "Hero Image (Right Panel)"
    },
    {
      "type": "image_picker",
      "id": "real_talk_logo_mobile",
      "label": "Real Talk Logo (Mobile)",
      "info": "Overlays the hero image on mobile devices"
    },
    {
      "type": "header",
      "content": "CTA Box"
    },
    {
      "type": "text",
      "id": "cta_title",
      "label": "CTA Title",
      "default": "What we're all about"
    },
    {
      "type": "richtext",
      "id": "cta_content",
      "label": "CTA Content",
      "default": "<p>Bras that pinch, shift, slip or simply don't fit right; if you have a fuller bust, then this is probably how it's been for you.</p>"
    },
    {
      "type": "richtext",
      "id": "content",
      "label": "Content",
      "default": "<p>Get access to our latest news by signing up for our newsletter.</p>"
    },
    {
      "type": "checkbox",
      "id": "show_newsletter_form",
      "label": "Show newsletter form",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_tags",
      "label": "Show tags",
      "default": true,
      "info": "Categorize your blog posts by [adding tags](https://help.shopify.com/en/manual/online-store/blogs/writing-blogs#add-tags-to-a-blog-post)."
    },
    {
      "type": "color",
      "id": "banner_background",
      "label": "Background"
    },
    {
      "type": "color",
      "id": "banner_text_color",
      "label": "Text"
    },
    {
      "type": "color",
      "id": "button_background",
      "label": "Button background"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button text"
    },
    {
      "type": "header",
      "content": "Blog post listing"
    },
    {
      "type": "range",
      "id": "articles_per_page",
      "label": "Articles per page",
      "min": 5,
      "max": 24,
      "step": 1,
      "default": 6
    },
    {
      "type": "checkbox",
      "id": "feature_first_article",
      "label": "Feature first blog post",
      "default": true
    },
    {
      "type": "color",
      "id": "feature_article_background",
      "label": "Featured article background"
    },
    {
      "type": "color",
      "id": "feature_article_text_color",
      "label": "Featured article text"
    },
    {
      "type": "header",
      "content": "Blog post card"
    },
    {
      "type": "checkbox",
      "id": "show_excerpt",
      "label": "Show excerpt",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_date",
      "label": "Show date",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_author",
      "label": "Show author",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_comments_count",
      "label": "Show comments count",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_category",
      "label": "Show category",
      "info": "The first post's tag will be shown as category.",
      "default": true
    }
  ]
}
{% endschema %}